-- Database: all_hands_on_board
--dotnet ef dbcontext scaffold "Host=localhost;Port=5432;Database=all_hands_on_board;Username=admin;Password=admin" Npgsql.EntityFrameworkCore.PostgreSQL


-- DROP DATABASE all_hands_on_board;
--DROP TABLE task_aggregation;
--DROP TABLE tasks;
--DROP TABLE users;
CREATE TABLE users(
	user_ID SERIAL PRIMARY KEY,
	name varchar(20) NOT NULL,
	surname varchar(30) NOT NULL,
	email varchar(30),
	occupation varchar(20) NOT NULL,
	index_no int,
	academic_title varchar(20),
	department varchar(30),
	points int,
	password varchar(50),
	token varchar(50)
);

CREATE TABLE tasks(
	task_ID SERIAL PRIMARY KEY,
	stateOfTask varchar(4) DEFAULT('TODO'),
	uploader_ID int REFERENCES users(user_ID) ON DELETE SET NULL,
	task_description varchar(400),
	short_description varchar(50),
	points_gained int NOT NULL,
	tag varchar(30),
	work_start_date TIMESTAMP NOT NULL,
	work_finish_date TIMESTAMP,
	signing_finish_date TIMESTAMP,
	upload_date TIMESTAMP default CURRENT_TIMESTAMP,
	no_of_students int NOT NULL
);

CREATE TABLE task_aggregation(
	aggegation_ID SERIAL PRIMARY KEY,
	user_ID int REFERENCES users(user_ID) ON DELETE CASCADE,
	task_ID int REFERENCES tasks(task_ID) ON DELETE CASCADE
);

insert into users values (1, 'Lukasz', 'Sobocinski', '217737@edu.p.lodz.pl', 'student', 217737, 'student', 'IFE', 0, 'abc', null);
insert into users values (2, 'Jakub', 'Stepaniak', '456576@edu.p.lodz.pl', 'student', 456576, 'student', 'EEIA', 0, 'good123', null);
insert into users values (3, 'Ada', 'Warkoczewska', 'aw@p.lodz.pl', 'teacher', null, 'doctor', 'EEIA', null, 'Hello', null);
insert into users values (4, 'Sonny', 'Miel', 'sm@p.lodz.pl', 'teacher', null, 'master', 'IFE', 0, 'dif#@', null);
insert into users values (5, 'Jan', 'Schyling', '344567@edu.p.lodz.pl', 'student', 344567, 'student', 'FTIMS', 0, '123', null);
insert into users values (6, 'Kozlarz', 'Babka', 'admin',  'admin', null, null, null, null, 'admin', null);

insert into tasks values (1, 'TODO', 3, 'Clean room number 334', 'Room cleaning', 12, 'Clean');
insert into tasks values (2, 'TODO', 3, 'Magic tricks', 'Magic', 3, 'Magic');
insert into tasks values (3, 'TODO', 4, 'Make a cake', 'Cake', 40, 'Cooking');
